<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>歌词同步</title>
  <style>
    #lyrics {
      font-size: 24px;
      line-height: 1.5;
      margin-top: 20px;
    }
    .current-lyric {
      color: red; /* 当前歌词高亮显示 */
      font-weight: bold;
    }
  </style>
</head>
<body>

  <audio id="audio" controls>
    <source src="F://小丑惊魂.mp3" type="audio/mp3">//放入音频，以这个举例
    Your browser does not support the audio element.
  </audio>

  <div id="lyrics"></div>

  <script>
const inputStr = `{'lyric': '[ 
        00: 00.00 
    ] 作词 : 小寒\n[ 
        00: 01.00 
    ] 作曲 : 方大同\n[ 
        00: 02.00 
    ] 编曲 : 方大同/Edward Chan\n[ 
        00: 17.03 
    ]欢笑声 欢呼声\n[ 
        00: 20.52 
    ]炒热气氛 心却很冷\n[ 
        00: 24.29 
    ]聚光灯 是种蒙恩\n[ 
        00: 27.95 
    ]我却不能 喊等一等\n[ 
        00: 31.42 
    ]我真佩服我 还能幽默\n[ 
        00: 35.03 
    ]掉眼泪时 用笑掩过\n[ 
        00: 38.78 
    ]怕人看破 顾虑好多\n[ 
        00: 42.50 
    ]不谈寂寞 我们就都快活\n[ 
        00: 48.40 
    ]我不唱声嘶力竭的情歌\n[ 
        00: 55.62 
    ]不表示没有心碎的时刻\n[ 
        01: 02.63 
    ]我不曾摊开伤口任宰割\n[ 
        01: 08.53 
    ]愈合 就无人晓得\n[ 
        01: 13.43 
    ]我内心挫折\n[ 
        01: 16.99 
    ]活像个孤独患者 自我拉扯\n[ 
        01: 24.27 
    ]外向的孤独患者 有何不可\n[ 
        01: 39.90 
    ]笑越大声 越是残忍\n[ 
        01: 43.45 
    ]挤满体温 室温更冷\n[ 
        01: 47.02 
    ]万一关灯 空虚扰人\n[ 
        01: 50.62 
    ]我却不能 喊等一等\n[ 
        01: 54.12 
    ]你说你爱我 却一直说\n[ 
        01: 57.57 
    ]说我不该 窝在角落\n[ 
        02: 01.18 
    ]策划逃脱 这也有错\n[ 
        02: 04.91 
    ]连我脆弱 的权利都掠夺\n[ 
        02: 10.85 
    ]我不唱声嘶力竭的情歌\n[ 
        02: 17.83 
    ]不表示没有心碎的时刻\n[ 
        02: 24.80 
    ]我不曾摊开伤口任宰割\n[ 
        02: 30.79 
    ]愈合 就无人晓得\n[ 
        02: 35.49 
    ]我内心挫折\n[ 
        02: 39.05 
    ]活像个孤独患者 自我拉扯\n[ 
        02: 46.07 
    ]外向的孤独患者 有何不可\n[ 
        03: 21.52 
    ]我不要声嘶力竭的情歌\n[ 
        03: 28.75 
    ]来提示我需要你的时刻\n[ 
        03: 35.59 
    ]表面镇定并不是保护色\n[ 
        03: 41.47 
    ]反而 是要你懂得\n[ 
        03: 46.10 
    ]我不知为何\n[ 
        03: 49.87 
    ]活像个孤独患者 自我拉扯\n[ 
        03: 57.01 
    ]外向的孤独患者 需要认可\n[ 
        04: 30.09 
    ]监制 : Edward Chan / Charles Lee / 方大同\n'}`;

// 提取并转换时间戳
const pattern = /\[\s*(\d{2}):\s*(\d{2})\.(\d{2})\s*\](.*?)\n/g;

// 对字符串进行时间戳转换
const resultStr = inputStr.replace(pattern, (match, minutes, seconds, milliseconds, lyric) => {
    // 转换时间为秒
    const timeInSeconds = parseInt(minutes) * 60 + parseInt(seconds) + parseInt(milliseconds) / 100;
    return `[ ${timeInSeconds.toFixed(2)} ]${lyric.trim()}\n`;
});

// 去掉 lyrics 字段
const cleanedStr = resultStr.replace("{'lyric': '", '').trim();
// 处理为二维数组
const lines = cleanedStr.split('\n').filter(line => line.trim() !== ''); // 按行分割
const lyricsData = lines.map(line => {
    const timePattern = /\[\s*(\d+(\.\d+)?)\s*\]/; // 匹配时间戳
    const timeMatch = line.match(timePattern);
    const time = timeMatch ? timeMatch[1] : null; // 提取时间戳

    const lyric = line.replace(timePattern, '').trim(); // 去除时间戳，获取歌词
    return [time, lyric]; // 返回二维数组格式
});

    // 获取音频和歌词容器元素
    const audio = document.getElementById('audio');
    const lyricsContainer = document.getElementById('lyrics');

    // 用于存储当前显示的歌词索引
    let currentLyricIndex = -1;

    // 函数：更新显示的歌词
    function updateLyrics() {
      const currentTime = audio.currentTime; // 获取当前音频播放时间（秒）

      // 查找当前播放时间对应的歌词
      for (let i = 0; i < lyricsData.length; i++) {
        // 如果当前时间大于或等于歌词的时间戳，并且下一个歌词的时间戳大于当前时间
        if (currentTime >= lyricsData[i][0] && (i === lyricsData.length - 1 || currentTime < lyricsData[i + 1][0])) {
          if (i !== currentLyricIndex) {
            currentLyricIndex = i;
            renderLyrics(i);
          }
          break;
        }
      }
    }

    // 函数：渲染当前歌词
    function renderLyrics(index) {
      lyricsContainer.innerHTML = ""; // 清空当前显示的歌词

      // 创建一个新的歌词元素并添加到容器
      const lyricElement = document.createElement('lyrics');
      lyricElement.textContent = lyricsData[index][1]; // 获取对应的歌词文本
      lyricElement.classList.add('current-lyric'); // 高亮显示当前歌词
      lyricsContainer.appendChild(lyricElement);
    }

    // 当音频播放时，定时更新歌词
    audio.addEventListener('timeupdate', updateLyrics);

    // 初始化时，渲染第一条歌词
    renderLyrics(0);

  </script>

</body>
</html>
